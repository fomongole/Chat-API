generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id            String         @id @default(uuid())
  email         String         @unique
  password      String
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  username      String         @unique
  about         String?        @default("Hey there! I'm using Chat App.")
  image         String?
  isOnline      Boolean        @default(false)
  lastSeen      DateTime       @default(now())
  messages      Message[]
  conversations Conversation[] @relation("UserConversations")
  isPrivate     Boolean        @default(false)
}

model Conversation {
  id           String    @id @default(uuid())
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  messages     Message[]
  participants User[]    @relation("UserConversations")
}

model Message {
  id             String   @id @default(uuid())
  content        String
  createdAt      DateTime @default(now())
  authorId       String
  conversationId String

  isRead Boolean @default(false)

  isDeleted Boolean @default(false)

  // Reply Functionality
  replyToId String?
  replyTo   Message?  @relation("ReplyRelation", fields: [replyToId], references: [id])
  replies   Message[] @relation("ReplyRelation")

  author       User         @relation(fields: [authorId], references: [id])
  conversation Conversation @relation(fields: [conversationId], references: [id])
}
